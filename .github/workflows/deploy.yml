# name: Deploy to Server

# on:
#   push:
#     branches: [ main, master, dev ]  # 可以根据需要调整分支
#   # 如果需要手动触发，可以添加：
#   # workflow_dispatch:

# jobs:
#   build-and-deploy:
#     runs-on: ubuntu-latest
    
#     steps:
#     # 1. 检出代码
#     - name: Checkout code
#       uses: actions/checkout@v4
    
#     # 2. 设置 Node.js 环境（如果是前端项目）
#     - name: Setup Node.js
#       uses: actions/setup-node@v4
#       with:
#         node-version: '24'  # 根据你的项目需求调整版本
#         cache: 'npm'
    
#     # 3. 安装依赖并打包构建
#     - name: Install dependencies and build
#       run: |
#         npm install
#         npm run build
#         echo "Build completed. Checking build output..."
#         ls -la blog/  # 检查构建输出
#       env:
#         CI: true
    
#     # 4. 配置 SSH 并部署到服务器
#     - name: Deploy to Server
#       uses: appleboy/scp-action@v0.1.7
#       with:
#         host: ${{ secrets.SERVER_HOST }}
#         username: ${{ secrets.SERVER_USER }}
#         key: ${{ secrets.SERVER_SSH_KEY }}
#         port: ${{ secrets.SSH_PORT || '22' }}
#         source: "blog/*"  # 上传 blog 目录下的所有内容（不包括 blog 目录本身）
#         target: ${{ secrets.TARGET_PATH }}
#         strip_components: 1  # 去掉第一层 blog 目录
#         overwrite: true  # 覆盖已存在的文件
        
#     # 5. 验证部署并执行远程命令
#     - name: Verify deployment and execute remote commands
#       uses: appleboy/ssh-action@v1.0.3
#       with:
#         host: ${{ secrets.SERVER_HOST }}
#         username: ${{ secrets.SERVER_USER }}
#         key: ${{ secrets.SERVER_SSH_KEY }}
#         port: ${{ secrets.SSH_PORT || '22' }}
#         script: |
#           echo "=== Deployment Verification ==="
#           echo "Target path: ${{ secrets.TARGET_PATH }}"
#           echo "Checking deployed files..."
#           ls -la ${{ secrets.TARGET_PATH }}/ | head -20
#           echo "Checking index.html..."
#           test -f ${{ secrets.TARGET_PATH }}/index.html && echo "✅ index.html exists" || echo "❌ index.html not found!"
#           echo "Deployment completed at $(date)"
#           # 可选：重启服务
#           # systemctl reload nginx